(()=>{"use strict";function e(e,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function s(e,s,r){return s in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}function r(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var t=function e(){r(this,e),this.annots=[],this.comments=[],this.bars="",this.spacer=0,this.chord=null},n=function e(s){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,e),this.note=s,this.modifiers=t,this.over=n,this.alternate=a},a=function(){function s(e){if(r(this,s),this.cells=[],!e)return this.title="",this.composer="",this.style="",this.key="",this.transpose=0,this.exStyle="",this.bpm=0,this.repeats=0,void(this.music="");var t=e.split("=");this.title=t[0].trim(),this.composer=this.parseComposer(t[1].trim()),this.style=t[3].trim(),this.key=t[4],this.transpose=+t[5]||0,this.exStyle=t[7],this.bpm=+t[8],this.repeats=+t[9]||3;var n=t[6].split("1r34LbKcu7");this.music=this.unscramble(n[1]),this.cells=this.parse()}var a,l;return a=s,(l=[{key:"parse",value:function(){for(var e=this.music.trim(),r=[];e;){for(var t=!1,a=0;a<s.regExps.length;a++){var l=s.regExps[a].exec(e);if(l){t=!0,l.length<=2?(r.push(l[0]),e=e.substr(l[0].length)):(r.push(l),e=e.substr(l[0].length));break}}t||(","!==e[0]&&r.push(e[0]),e=e.substr(1))}for(var i=[],u=this.newCell(i),c=null,h=0;h<r.length;h++){var o=r[h];switch(o instanceof Array&&(u.chord=this.parseChord(o),o=" "),o[0]){case"{":case"[":u.bars=o,o=null;break;case"|":c&&(c.bars+=")",c=null),u.bars="(",o=null;break;case"]":case"}":case"Z":c&&(c.bars+=o,c=null),o=null;break;case"n":u.chord=new n(o[0]);break;case",":o=null;break;case"S":case"T":case"Q":case"N":case"U":case"s":case"l":case"f":case"*":u.annots.push(o),o=null;break;case"Y":u.spacer++,o=null,c=null;break;case"r":case"x":case"W":u.chord=new n(o);break;case"<":o=o.substr(1,o.length-2),u.comments.push(o),o=null}o&&h<r.length-1&&(c=u,u=this.newCell(i))}return i}},{key:"parseComposer",value:function(e){var s=e.split(/(\s+)/);return 3==s.length?s[2]+s[1]+s[0]:e}},{key:"parseChord",value:function(e){var r=e[1]||" ",t=e[2]||"",a=e[3]||"";a&&(t+=a.substr(1,a.length-2));var l=e[4]||"";"/"===l[0]&&(l=l.substr(1));var i=e[5]||null;if(i&&(e=s.chordRegex.exec(i.substr(1,i.length-2)),i=e?this.parseChord(e):null)," "===r&&!i&&!l)return null;if(l){var u="#"===l[1]||"b"===l[1]?2:1;l=new n(l.substr(0,u),l.substr(u),null,null)}else l=null;return t=t.replace(/b/g,"♭").replace(/#/g,"♯"),new n(r,t,l,i)}},{key:"newCell",value:function(e){var s=new t;return e.push(s),s}},{key:"unscramble",value:function(e){for(var s,r="";e.length>51;)s=e.substring(0,50),e=e.substring(50),r+=this.obfusc50(s);return(r+=e).replace(/Kcl/g,"| x").replace(/LZ/g," |").replace(/XyQ/g,"   ")}},{key:"obfusc50",value:function(e){for(var s=e.split(""),r=0;r<5;r++)s[49-r]=e[r],s[r]=e[49-r];for(var t=10;t<24;t++)s[49-t]=e[t],s[t]=e[49-t];return s.join("")}}])&&e(a.prototype,l),s}();s(a,"chordRegex",/^([A-G][b#]?)((?:sus|alt|add|[\+\-\^\dhob#])*)(\*.+?\*)*(\/[A-G][#b]?)?(\(.*?\))?/),s(a,"chordRegex2",/^([ Wp])()()(\/[A-G][#b]?)?(\(.*?\))?/),s(a,"regExps",[/^\*[a-zA-Z]/,/^T\d\d/,/^N./,/^<.*?>/,a.chordRegex,a.chordRegex2])})();